<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - NLP Document Extraction Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .feature-card {
            transition: transform 0.2s;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .upload-area {
            border: 2px dashed #007bff;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        .upload-area:hover {
            border-color: #0056b3;
            background-color: #f8f9fa;
        }
        .upload-area.dragover {
            border-color: #28a745;
            background-color: #d4edda;
        }
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 0;
        }
        .api-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- API Status Indicator -->
    <div class="api-status">
        <div class="badge bg-success" id="api-status">
            <i class="fas fa-circle me-1"></i>Enhanced API Online
        </div>
    </div>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <h1 class="display-4 fw-bold mb-4">{{ title }}</h1>
                    <p class="lead mb-4">{{ description }}</p>
                    <div class="row">
                        <div class="col-md-6">
                            <h5><i class="fas fa-file-alt me-2"></i>Supported Formats</h5>
                            <div class="d-flex justify-content-center flex-wrap gap-2 mt-2">
                                {% for format in supported_formats %}
                                <span class="badge bg-light text-dark">{{ format }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="fas fa-cogs me-2"></i>Advanced Features</h5>
                            <div class="text-start">
                                <small>• Table extraction • Quality assessment</small><br>
                                <small>• Batch processing • Multi-format support</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container my-5">
        <!-- Document Upload Section -->
        <div class="row mb-5">
            <div class="col-lg-8 mx-auto">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="fas fa-upload me-2"></i>Enhanced Document Processing</h4>
                    </div>
                    <div class="card-body">
                        <div class="upload-area" id="upload-area">
                            <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                            <h5>Drop files here or click to upload</h5>
                            <p class="text-muted">Supports PDF, DOCX, HTML, TXT files</p>
                            <input type="file" id="file-input" class="d-none" accept=".pdf,.docx,.doc,.html,.htm,.txt" multiple>
                            <button class="btn btn-primary" onclick="document.getElementById('file-input').click()">
                                Select Files
                            </button>
                        </div>
                        
                        <!-- Processing Options -->
                        <div class="mt-4">
                            <h6>Processing Options:</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="extract-tables" checked>
                                        <label class="form-check-label" for="extract-tables">
                                            Extract Tables
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="quality-check" checked>
                                        <label class="form-check-label" for="quality-check">
                                            Quality Assessment
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="extract-metadata" checked>
                                        <label class="form-check-label" for="extract-metadata">
                                            Extract Metadata
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="batch-mode">
                                        <label class="form-check-label" for="batch-mode">
                                            Batch Processing Mode
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-section" class="d-none">
            <div class="row">
                <div class="col-12">
                    <h3><i class="fas fa-chart-line me-2"></i>Processing Results</h3>
                    <div id="results-container"></div>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="row mb-5">
            <div class="col-12">
                <h3 class="text-center mb-4">Enhanced Processing Features</h3>
                <div class="row">
                    {% for feature in features %}
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card feature-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-magic fa-2x text-primary mb-3"></i>
                                <h5 class="card-title">{{ feature }}</h5>
                                <p class="card-text text-muted">Advanced NLP processing with intelligent pattern recognition</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- API Endpoints Section -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-code me-2"></i>Available API Endpoints</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Enhanced Document API (Port 8001)</h6>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <code>POST /upload-enhanced/</code> - Advanced processing
                                    </li>
                                    <li class="list-group-item">
                                        <code>POST /batch-process/</code> - Multiple documents
                                    </li>
                                    <li class="list-group-item">
                                        <code>GET /processing-stats</code> - Capability info
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Standard API (Port 8000)</h6>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <code>POST /upload/</code> - Standard processing
                                    </li>
                                    <li class="list-group-item">
                                        <code>POST /extract-custom/</code> - Custom fields
                                    </li>
                                    <li class="list-group-item">
                                        <code>GET /health</code> - Health check
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // File upload handling
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const resultsSection = document.getElementById('results-section');
        const resultsContainer = document.getElementById('results-container');

        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // File processing
        async function handleFiles(files) {
            if (files.length === 0) return;

            const batchMode = document.getElementById('batch-mode').checked;
            const apiUrl = batchMode && files.length > 1 ? 
                'http://localhost:8001/batch-process/' : 
                'http://localhost:8001/upload-enhanced/';

            try {
                showProcessingIndicator();
                
                if (batchMode && files.length > 1) {
                    await processBatch(files, apiUrl);
                } else {
                    await processSingle(files[0], apiUrl);
                }
            } catch (error) {
                showError('Processing failed: ' + error.message);
            }
        }

        async function processSingle(file, apiUrl) {
            const formData = new FormData();
            formData.append('file', file);

            const response = await fetch(apiUrl, {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            displayResults([result]);
        }

        async function processBatch(files, apiUrl) {
            const formData = new FormData();
            for (let file of files) {
                formData.append('files', file);
            }

            const response = await fetch(apiUrl, {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            displayBatchResults(result);
        }

        function showProcessingIndicator() {
            resultsContainer.innerHTML = `
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Processing...</span>
                    </div>
                    <p class="mt-2">Processing documents with enhanced engine...</p>
                </div>
            `;
            resultsSection.classList.remove('d-none');
        }

        function displayResults(results) {
            let html = '';
            results.forEach((result, index) => {
                const qualityColor = result.quality_score > 0.7 ? 'success' : 
                                   result.quality_score > 0.4 ? 'warning' : 'danger';
                
                html += `
                    <div class="card mb-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Document: ${result.filename || 'Document ' + (index + 1)}</h5>
                            <span class="badge bg-${qualityColor}">Quality: ${(result.quality_score * 100).toFixed(1)}%</span>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Document Info</h6>
                                    <ul class="list-unstyled">
                                        <li><strong>Type:</strong> ${result.document_type.toUpperCase()}</li>
                                        <li><strong>Size:</strong> ${formatFileSize(result.file_size || 0)}</li>
                                        <li><strong>Processing Time:</strong> ${result.processing_time?.toFixed(2) || 0}s</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6>Extracted Content</h6>
                                    <ul class="list-unstyled">
                                        <li><strong>Text Length:</strong> ${result.text_content?.length || 0} chars</li>
                                        <li><strong>Tables Found:</strong> ${result.tables?.length || 0}</li>
                                        <li><strong>Metadata Fields:</strong> ${Object.keys(result.metadata || {}).length}</li>
                                    </ul>
                                </div>
                            </div>
                            
                            ${result.tables && result.tables.length > 0 ? `
                                <div class="mt-3">
                                    <h6>Extracted Tables</h6>
                                    <div class="table-responsive">
                                        <small class="text-muted">Found ${result.tables.length} table(s)</small>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="mt-3">
                                <h6>Text Preview</h6>
                                <div class="bg-light p-3 rounded" style="max-height: 200px; overflow-y: auto;">
                                    <pre class="mb-0">${(result.text_content || '').substring(0, 500)}${(result.text_content || '').length > 500 ? '...' : ''}</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            resultsContainer.innerHTML = html;
        }

        function displayBatchResults(batchResult) {
            let html = `
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="mb-0">Batch Processing Results</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h4 class="text-primary">${batchResult.total_files}</h4>
                                    <small>Total Files</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h4 class="text-success">${batchResult.successful_files}</h4>
                                    <small>Successful</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h4 class="text-info">${batchResult.total_processing_time?.toFixed(2)}s</h4>
                                    <small>Total Time</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h4 class="text-warning">${batchResult.batch_id}</h4>
                                    <small>Batch ID</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            batchResult.results?.forEach((file, index) => {
                const statusColor = file.success ? 'success' : 'danger';
                html += `
                    <div class="card mb-2">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">${file.filename}</h6>
                                    <small class="text-muted">${file.document_type?.toUpperCase() || 'Unknown'} • ${file.text_length || 0} characters</small>
                                </div>
                                <div class="text-end">
                                    <span class="badge bg-${statusColor}">${file.success ? 'Success' : 'Failed'}</span>
                                    ${file.success ? `<div><small>${file.processing_time?.toFixed(2)}s • Quality: ${(file.quality_score * 100).toFixed(1)}%</small></div>` : ''}
                                    ${file.error ? `<div><small class="text-danger">${file.error}</small></div>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            resultsContainer.innerHTML = html;
        }

        function showError(message) {
            resultsContainer.innerHTML = `
                <div class="alert alert-danger" role="alert">
                    <h6 class="alert-heading">Processing Error</h6>
                    <p class="mb-0">${message}</p>
                </div>
            `;
            resultsSection.classList.remove('d-none');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Check API status
        async function checkApiStatus() {
            try {
                const response = await fetch('http://localhost:8001/health-enhanced');
                const status = await response.json();
                document.getElementById('api-status').innerHTML = 
                    '<i class="fas fa-circle me-1"></i>Enhanced API Online';
                document.getElementById('api-status').className = 'badge bg-success';
            } catch (error) {
                document.getElementById('api-status').innerHTML = 
                    '<i class="fas fa-circle me-1"></i>API Offline';
                document.getElementById('api-status').className = 'badge bg-danger';
            }
        }

        // Initialize
        checkApiStatus();
        setInterval(checkApiStatus, 30000); // Check every 30 seconds
    </script>
</body>
</html>